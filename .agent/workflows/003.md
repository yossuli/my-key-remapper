---
description: 適切なコミット粒度とメッセージの規約
---

# [Fix-003] 適切なコミット粒度とメッセージの規約

## 概要

コードベースの健全な履歴管理のため、コミットは論理的な変更単位で行い、一括ステージング（`git add .`）を避ける運用を徹底するためのルールです。

## 原則

1.  **一括ステージングの禁止**: 意図しないファイル（一時ファイルや別タスクの変更）が混入するのを防ぐため、原則として `git add .` は使用しない。
    - 代わりに `git add <file>...` を使用する。
    - コミット前に必ず `git status` でステージングされたファイルを確認する。
2.  **コミットの粒度**: 「1 つのコミット＝ 1 つの論理的な変更」とする。
    - リファクタリングと機能追加は分ける。
    - ドキュメント修正とコード修正は（可能なら）分ける。
3.  **メッセージの規約**:
    - **含めるべきもの**: 「何を変更したか (What)」「なぜ変更したか (Why)」。
    - **含めてはいけないもの**: 「どうやって考えたか (Process)」「苦労話」。
    - **形式**: 1 行目に概要、空行を挟んで詳細を書く。

## 手順 (Workflow)

### 1. 変更の確認

```bash
git status
# どのファイルが変更されたか確認
```

### 2. 選択的ステージング

```bash
git add src/path/to/fileA.ts src/path/to/fileB.tsx
# 関連するファイルのみを追加
```

### 3. ステージング状態の確認

```bash
git diff --staged --stat
# 意図したファイルだけが含まれているか最終確認
```

### 4. コミット

```bash
git commit -m "type: 概要" -m "詳細な説明（箇条書き推奨）"
```

## トラブルシューティング

### 誤って `git add .` してしまった場合

```bash
git restore --staged .
# ステージングを全て解除（作業ファイルはそのまま）
```

### 誤った内容でコミットしてしまった場合（Push 前）

```bash
git reset --soft HEAD~1
# 直前のコミットを取り消し、変更をステージング状態に戻す
# その後、正しいファイルだけ add し直してコミットする
```
