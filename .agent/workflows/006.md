---
description: スプレッド分割代入後の型定義の再配置
---

# [Workflow-006] スプレッド分割代入後の型定義の再配置

## 概要

[Workflow-002](./002.md)（スプレッド演算子による分割代入でのグループ化）を適用した後、親コンポーネントで定義されていた「グループ型」が親自身では使用されなくなることがあります。この場合、型定義を適切な子コンポーネント（そのドメインのハブとなるコンポーネント）へ移動し、コードのクリーンさとトレーサビリティを維持します。

## 課題

スプレッド分割代入を適用すると、親コンポーネント内での型注釈（例: `const layerActions: LayerActions = { ... }`）が不要になります。しかし、その型は依然として子コンポーネントの Props 定義（`interface ChildProps { layerActions: LayerActions }`）で必要とされています。

このとき、型定義が親コンポーネントに残ったままだと、以下の問題が発生します。

1. **循環参照のリスク**: 子が親を `import` することになり、構成が複雑になる（特にその型がドメイン知識を多く含む場合）。
2. **凝集度の低下**: 親が「自分が使わない型」を公開し続けることになる。

## 解決策

使用されなくなった型定義を、その Props を直接受ける**メインの子コンポーネント**（そのドメインにおいて中心的な役割を果たすコンポーネント）へ移動します。

### 手順

1. **移動対象の特定**: 親コンポーネント内で、もう使用されていない `export type` や `export interface` を特定する。
2. **移動先の選定**: その型を Props として受け取り、かつそのドメインにおいて「中心」となる子コンポーネント（例: `KeyRemapSection.tsx`）を選定する。
3. **コードの移動**: 親コンポーネントから型定義を切り出し、選定した子コンポーネントのファイルへ移動・`export` する。
4. **インポートの修正**:
   - **親コンポーネント**: 移動先の子コンポーネントから型をインポートして Props の型注釈に利用する。
   - **他の子コンポーネント**: 同じ型を利用している「兄弟」コンポーネントがある場合は、定義を移動した子コンポーネントからインポートする。

### Good Example

**1. メインの子コンポーネント (`MainChild.tsx`)**

```typescript
export type LayerActions = Pick<UseLayerStateReturn, "setLayerId" | "addLayer">;

interface MainChildProps {
  layerActions: LayerActions;
}
```

**2. 親コンポーネント (`Parent.tsx`)**

```typescript
import type { LayerActions } from "./MainChild";

const { layers, ...layerActions } = useLayerState();
// ...
return <MainChild layerActions={layerActions} />;
```

**3. 他の兄弟コンポーネント (`SidePanel.tsx`)**

```typescript
import type { LayerActions } from "./MainChild";

interface SidePanelProps {
  layerActions: LayerActions;
}
```

## チェックリスト

- [ ] 親コンポーネントで直接使用されていない型を特定したか？
- [ ] ドメインの中心となる子コンポーネントへ型定義を正しく移動したか？
- [ ] すべての子・兄弟コンポーネントのインポート元を修正したか？
- [ ] 親コンポーネントの不要な型定義/インポートを削除したか？
- [ ] `npm run build` で型エラーが発生しないことを確認したか？
