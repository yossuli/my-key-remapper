---
description: カリー化による Prop 渡しの簡略化
---

# [Workflow-007] カリー化による Prop 渡しの簡略化

## 概要

React コンポーネントにおいて、ループ内で特定の値（ID や Key など）を引数に取る関数を Props として渡す場合、アロー関数をインラインで記述すると可読性が低下し、レンダリングごとの関数生成の原因にもなります。
これを提供元（カスタムフック等）でカリー化された関数として提供することで、呼び出し側の記述を大幅に簡略化します。

## Bad/Good Example

### Bad (インラインアロー関数)

呼び出し側で毎回引数を渡す必要があり、記述が冗長になります。

```tsx
// KeyRemapperPage.tsx
<KeyEditorForm
  onSave={(trigger, action, timing) =>
    saveMapping(editingKey, trigger, action, timing)
  }
/>
```

### Good (カリー化された関数)

事前に特定の引数（`editingKey`）を固定した関数を取得して渡すため、非常に簡潔になります。

```tsx
// KeyRemapperPage.tsx
<KeyEditorForm onSave={saveMapping(editingKey)} />
```

## 手順 (Step-by-Step)

### 1. 提供元（カスタムフック）での実装

関数を「引数を受け取って、残りの引数を受け取る関数を返す」形式に修正します。

```typescript
// useLayerState.ts
const saveMapping = useCallback(
  (from: number) =>
    (trigger: TriggerType, action: Action, timing?: number | null) => {
      // 実際の処理
      send("save-key-config", { from, trigger, action, timing });
    },
  [send]
);
```

### 2. 型定義の修正

カリー化された形式に合わせて型定義を更新します。ソースの型と同期させるため `UseLayerStateReturn["saveMapping"]` などの参照を利用することを推奨します。

```typescript
// KeyRemapperPage.tsx
export interface MappingActions {
  saveMapping: UseLayerStateReturn["saveMapping"];
}
```

### 3. 呼び出し側の修正

アロー関数を削除し、カリー化された関数に最初の引数だけを渡したものを Props にセットします。

```tsx
<KeyEditorForm onSave={saveMapping(editingKey)} />
```

## チェックリスト

- [ ] 関数がカリー化形式（`arg1 => (arg2, arg3) => void`）になっているか？
- [ ] 呼び出し側で `onSave={fn(id)}` のような簡潔な記述になっているか？
- [ ] 型定義が `UseLayerStateReturn` などのソースと同期されているか？
- [ ] `npm run build` で型エラーが発生しないか？

## 知見の継続的改善 (Continuous Knowledge Improvement)

このワークフローを使用する中で、新しい指示や改善点が見つかった場合は、必ずこのファイル (`.agent/workflows/007.md`) を更新・改善することを提案してください。
