---
description: プロップスフロー可視化によるリファクタリングの推進
---

# [Workflow-009] プロップスフロー可視化によるリファクタリングの推進

## 概要

開発が進むにつれてコンポーネントツリーが深くなると、意図しない Prop Drilling（バケツリレー）が発生し、コードの複雑度が増大します。
このワークフローでは、プロップス伝播をマトリクスとして「書き出す」ことで、不自然な依存関係を可視化し、Hooks への移行や Prop Grouping の適正化を判断する手順を示します。

> [!IMPORTANT]
> 本プロジェクトでは **Context API は使用しません**。バケツリレーの解消は「Hooks への抽出」または「Prop Grouping」によって行います。

## 手順

### 1. マトリクスの作成（可視化）

`props_flow.md` 等のドキュメントに、コンポーネントを横軸、プロップスを縦軸に取ったマトリクスを作成します。

- **🆕 (Define)**: 生成
- **🚌 (Drill)**: 自分は使わず子に渡すだけ（バケツリレー）
- **🔥 (Use)**: 実際に使用
- **🎁 (Pass Group)**: グループとしての運搬
- **🧩 (Individual)**: 個別渡し

### 2. リファクタリング対象の発見

マトリクスが完成したら、以下の改善サインを探します。

- **「🚌 (Drill)」の縦列**: 多くの階層を通過しているプロップスは、Hooks 化して末端が直接取得するようにするか、適切なグループに含めて運搬効率を上げます。
- **「🧩 (Individual)」の密集**: 関連するプロップスがバラバラに渡されている場所は、[Workflow-005](./005.md) に基づきグループ化します。

### 3. リファクタリングの実行

1.  **Hooks への抽出**: 状態管理ロジックをカスタムフックにまとめ、末端コンポーネントが直接 `useXxx()` を呼び出して自律化（Smart 化）します。
2.  **Prop Grouping の強化**: 親での一括制御が必要なデータは、適切な Group 型を定義して中間層を通過させます。
3.  **伝播の遮断**: 不要になったプロップスを中間層から削除し、マトリクスを「➖」で埋めていきます。

## チェックリスト

- [ ] プロップス伝播を一通り書き出し、🚌 を特定したか？
- [ ] Context API を安易に使おうとしていないか？（Grouping で解決する）
- [ ] 中間コンポーネントでの不要な Props 定義が削除されたか？
- [ ] マトリクスを更新し、改善結果を視覚的に確認したか？
