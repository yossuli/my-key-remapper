---
description: 大規模機能の実装計画策定ガイドライン
---

# [Workflow-010] 大規模機能の実装計画策定 (High-Quality Feature Planning)

## 概要

新機能や大規模なリファクタリングの実装計画を立てる際、後戻りを防ぎ、スムーズな実装とレビューを実現するためのガイドラインです。
単なるタスクリストではなく、**「これを見れば最終的にどうなるかが完全に理解できる（Source of Truth）」**レベルの計画書を作成することを目的とします。

## 重要な構成要素 (The "Must-Haves")

実装計画書 (`implementation_plan.md`) には、必ず以下の要素を含めてください。

### 1. 具体的コードスニペット (Concrete Code Snippets)

自然言語の説明だけでなく、実際のコードの断片を必ず含めてください。

- **データ構造**: 定義する型（Interface/Type）、データベーススキーマ、State の形状。
- **ロジック**: 複雑なアルゴリズム、状態遷移、非同期処理のフロー（擬似コード可）。
- **インターフェース**: 公開関数のシグネチャ、API のエンドポイント定義。

### 2. 詳細な UI/UX 設計 (UX/UI Specification)

「画面を作る」という記述だけでなく、具体的なインタラクションと構成を定義します。

- **画面遷移**: モーダル、ドリルダウン、タブ切り替えなどの構造。
- **状態定義**: Loading, Error, Empty などのエッジケース。
- **インタラクション**: ドラッグ＆ドロップ、ショートカットキー、バリデーションの挙動。
- **ライブラリ選定**: 使用する既存ライブラリやコンポーネントの明記。

### 3. アーキテクチャと関心の分離 (Architecture & Separation)

実装の簡便さよりも、長期的な保守性と拡張性を優先した設計を行います。

- **正規化 (Normalization)**: データの実体（Definition）と参照（Reference）を分離し、データの重複を防ぐ（例：ID 参照モデル）。
- **責務の分離**: データ管理、ビジネスロジック、UI 表示を適切なレイヤーやコンポーネントに分割する。
- **エディタの独立**: 複雑なオブジェクトの編集は、インラインではなく専用の管理画面（Manager）や独立したエディタに切り出すことを検討する。

### 4. 実行モデルと副作用 (Execution & Side Effects)

- **同期/非同期の明確化**: 処理がブロッキングか、非同期（Fire-and-forget / Promise 待機）かを明記する。
- **エラーハンドリング**: 失敗時の挙動（ロールバック、ユーザー通知、ログ出力）を定義する。

---

## 計画策定プロセス (Process)

1.  **要件の構造化**: 自然言語の要件を、システム上のエンティティとアクションに分解する。
2.  **型定義**: まずデータ構造（型）を書き下す。これが全ての土台となる。
3.  **UI フローの可視化**: ユーザーがどう操作し、データがどう変化するかをシミュレーションする。
4.  **「Bad」の排除**: 密結合、循環参照、過度なネストなど、設計上のアンチパターンがないか自問する。
5.  **レビュー**: 作成した計画をユーザーに提示し、フィードバックを得て修正する。

## チェックリスト (Self-Correction Checklist)

計画をユーザーに提示する前に、以下の質問に答えてください。

- [ ] **その計画書だけで実装可能か？**: 計画書を見ながら、迷わずコードを書けるレベルになっているか？
- [ ] **「実際にどう動くか」が目に浮かぶか？**: UI の挙動やデータフローが具体的にイメージできるか？
- [ ] **コード断片は適切か？**: 主要な型定義や関数シグネチャが含まれているか？
- [ ] **将来の拡張に耐えうるか？**: データの正規化や責務の分離は適切に行われているか？

## 知見の継続的改善 (Continuous Knowledge Improvement)

このワークフローを使用する中で、新しい指示や改善点が見つかった場合は、必ずこのファイル (`.agent/workflows/010.md`) を更新・改善することを提案してください。
