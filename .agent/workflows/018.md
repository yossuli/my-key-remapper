---
description: Strict Linter/Type Fix
---

# [Workflow-018] Strict Linter/Type Fix (Fix QA Errors)

## 概要

`npm run typecheck` (TypeScript) や `npm run lint` (Biome) で発生したエラーを修正する際の、厳格な手順と禁止事項です。安易なエラー抑制（ignore）を防ぎ、コードベースの健全性を維持します。

## 禁止事項 (Strict Prohibitions)

- **`biome-ignore` の使用禁止**:
  - 原則として、Lint エラーはコード構造の修正によって解消してください。
  - どうしても抑制が必要な場合（例: 外部ライブラリの制約）は、**必ずユーザーの明示的な許可（y/OK）を得てから** 適用してください。勝手に追加してはいけません。
- **`as` (型アサーション) の乱用禁止**:
  - `as any` は論外です。
  - `as unknown as T` などのキャストも避け、Type Guard 関数や適切な型定義修正を優先してください。
  - **例外**: `as const` は ReadOnly な型定義やリテラル型の固定に有効なため、積極的に利用してください。

## 手順 (Step-by-Step)

### 1. 自動修正の適用 (Auto-fix First)

- エラー分析や手動修正を行う前に、まず **自動修正** を試みます。
- `ultracite` (Biome wrapper) は、フォーマットや安全な修正を自動で行う機能を持っています。
- 手順:
  ```bash
  npm run ultracite:fix
  ```
- これにより、大量のフォーマットエラーや単純な修正漏れが一括解消され、真に対処すべき論理エラーだけが残ります。また、エラー過多によるツールクラッシュを防ぐ効果もあります。
- 実行後は再度 `npm run lint` (または `npm run ultracite:check`) を実行し、残存エラーを確認してください。

### 2. エラー内容の取得と分析

- **取得方法**:
  - `npm run typecheck` や `npm run lint` の出力を利用して把握します。
- **分析**:
  - エラーメッセージを読み、なぜそのエラーが出ているかを理解します。
  - 単なる「型が合わない」だけでなく、ロジックの不整合の可能性を疑います。

### 3. コード修正による解決 (Preferred)

- **型定義の修正**: 必要であれば `interface` や `type` を修正します。
- **ロジックの修正**: `if` チェックや Optional Chaining (`?.`)、Nullish Coalescing (`??`) を使用して、安全に値にアクセスします。
- **Type Guard**: `isString(value)` のようなユーザー定義 Type Guard を活用します。

### 4. レビュー依頼 (抑制が必要な場合)

- どうしても `biome-ignore` や `as` が必要と判断した場合は、ユーザーに以下を報告します。
  - エラー内容
  - 抑制が必要な理由（なぜコード修正では解決できないか）
  - 抑制する範囲（1 行のみに限定する等）
- 許可が得られるまで適用しません。

## チェックリスト

- [ ] **最初に `npm run ultracite:fix` を実行したか？**
- [ ] `biome-ignore` を勝手に追加していないか？
- [ ] `as any` を使用していないか？
- [ ] 修正後に `npm run typecheck` と `npm run lint` がパスすることを確認したか？

## 知見の継続的改善

新しいエラーパターンや解決策が見つかった場合は、本ドキュメントを更新してください。
