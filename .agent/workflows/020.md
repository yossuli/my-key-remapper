---
description: 議論から計画への昇格
---

# [Workflow-020] 議論から計画への昇格 (Escalate to Plan)

## 概要

チャット上での提案や議論が複雑化・長期化しそうな場合、またはユーザーからの指示があった場合に、散発的なやり取りを中断し、構造化された「実装計画書 (`implementation_plan.md`)」の作成・更新フェーズへ意図的に切り替えるための手順です。

## 適用条件 (Trigger)

以下のいずれかに該当した場合、このワークフローを発動します。

1.  **ユーザー指示**: 「Plan を作成して」「計画を立てて」と言われた場合。
2.  **複雑性**: 提案する変更要素が 5 つ以上、または複数のファイル/コンポーネントにまたがる場合。
3.  **議論の停滞**: 同じトピックで 3 往復以上のやり取りが発生し、方針が定まらない場合。
4.  **変更提案**: 「チャットで提案しようとしたが、長くなりそう」と自己判断した場合。

## 手順 (Step-by-Step)

### 1. 提案の停止と切り替え宣言

- チャットで長文の提案を書き始める前に、以下のように宣言します。
  > 提案内容が複雑になるため、一度 `implementation_plan.md` として計画を作成し、提示してもよろしいでしょうか？

### 2. 実装計画書の作成・更新 (PLANNING Mode)

- **モード切替**: `task_boundary` で `Mode: PLANNING` に切り替えます。
- **アーティファクト更新**:
  - **ファイル名**: 既存の `implementation_plan.md` との衝突を避けるため、`[トピック名]_implementation_plan.md` （例: `macro_storage_implementation_plan.md`）という具体的で一意な名前を使用します。
  - **記述内容**:
    - **Goal**: 何を解決するのか。
  - **Goal**: 何を解決するのか。
  - **User Review Required**: 承認が必要な重要事項。
  - **Proposed Changes**: 具体的な変更ファイルと内容。
  - **Verification Plan**: 検証手順。

### 3. レビュー依頼

- `notify_user` で計画書のレビューを依頼します。
  > 実装計画を作成しました。この内容で進めてよろしいでしょうか？

### 4. 承認後の実行 (EXECUTION Mode)

- ユーザーの承認（`y` / `OK`）を得てから、初めてコードの実装（`EXECUTION`）に移ります。
- 計画なしにコードを書き始めてはいけません。

## メリット

- **手戻りの防止**: 実装前に設計の合意が取れる。
- **コンテキストの保持**: チャットが流れても、計画書が SSOT (Single Source of Truth) として残る。
- **レビューの効率化**: ユーザーは構造化されたドキュメントで全体像を把握できる。

## チェックリスト

- [ ] 複雑な提案をチャットに直書きせず、計画書への昇格を提案したか？
- [ ] `task_boundary` を PLANNING に切り替えたか？
- [ ] 承認を得るまでコード変更を行わなかったか？

## 知見の継続的改善

計画書のフォーマットや運用に変更がある場合は、本ドキュメントを更新してください。
