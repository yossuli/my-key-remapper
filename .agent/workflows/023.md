---
description: .agent/ 配下のファイル（規約・ワークフロー）編集時のドラフト運用
---

# [Workflow-023] 規約・ワークフロー編集時のドラフト運用 (Draft Usage for Rules and Workflows)

## 概要

`.agent/` 配下の規約ファイル（`GEMINI.md`, `RULE.md` 等）および `.agent/workflows/` 配下のワークフローファイルを編集・作成する場合、直接変更を加えるのではなく、まず一時的なディレクトリ（`_drafts/`）にドラフトを作成してレビューを受け、承認後に正式な場所に移動する手順です。
これは、プロジェクトの根幹に関わるルールやナレッジの誤編集・消失を防ぎ、変更内容を確実に監査可能にするためです。

## 手順 (Step-by-Step)

### 1. ドラフトディレクトリの準備

- プロジェクトルートに `_drafts/` ディレクトリが存在するか確認し、なければ作成します。

### 2. ドラフトファイルの作成

- **新規ファイル作成時**:
  - 作成したいファイルのファイル名（例: `034.md`）で、`_drafts/` 配下にファイルを作成します。
  - `write_to_file` ツールを使用します。
- **既存ファイル編集時**:
  - 元ファイルを `_drafts/` 配下にコピー（`cp`）します。
  - コピー後、**即座に `git add` を実行**して、現在の状態をインデックスに登録（ベースライン固定）します。
    - これにより、その後の編集がエディタや Git 上で明確な「差分（Diff）」として扱われ、レビューが容易になります。

### 3. ユーザーレビュー依頼

- `notify_user` を使用して、作成したドラフトファイルのレビューを依頼します。
- **PathsToReview** にドラフトファイルのパスを含めます。
- **Diff の提示**: 既存ファイルの編集時は、`render_diffs` 等を用いて変更箇所を明確に提示してください。
- メッセージ例:
  > `[Workflow-023] タイトル` の改訂ドラフトを `_drafts/` に作成しました。`git add` により編集箇所の Diff を確認可能にしています。併せて `render_diffs` もご確認ください。

### 4. 正式配置への移動（承認後）

- ユーザーの承認（y/OK）を得たら、ファイルを正式なディレクトリに移動します。
- **重要: ファイルの正式な配置場所を確認してください。**
  - **規約 (Rules)**: `.agent/GEMINI.md`, `.agent/RULE.md` 等。
  - **ワークフロー (Workflows)**: `.agent/workflows/XXX.md` （ファイル名は数字三桁）。
- 移動には `mv` を使用します。
  ```bash
  # 規約の例
  mv _drafts/GEMINI.md .agent/GEMINI.md
  # ワークフローの例
  mv _drafts/023.md .agent/workflows/023.md
  ```
- **移動の確認 (Verification)**: 移動後、必ず `list_dir` 等で正式な場所にファイルが存在し、元の `_drafts/` から削除されていることを確認してください。

### 5. 後片付け

- 移動後、ファイル内の内部参照（リンク等）が正しいパスを指しているか確認します。
- `_drafts/` 内の古い重複ファイルや一時ファイルは削除します。

## チェックリスト

- [ ] 正式な配置場所（`.agent/` 直下か `workflows/` 配下か）を確認したか？
- [ ] 既存編集時、`git add` でベースラインを固定したか？
- [ ] `_drafts/` を使用してレビューを依頼したか？
- [ ] 承認後に正しいパスへ移動したか？

## 知見の継続的改善

レビュー手順や一時ディレクトリの運用に変更がある場合は、本ドキュメントを更新してください。
