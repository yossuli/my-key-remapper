---
description: ユーザーが変更を確認できない場合に、指示を受けて強制上書きを行う手順
---

# [Workflow-025] 編集反映失敗時の強制リカバリ (Manual Force Overwrite)

## 概要

AI が「編集完了」と報告したにもかかわらず、ユーザー側で変更が確認できない場合（Phantom Edits）に、ユーザーの明示的な指示に基づいて実行するリカバリ手順です。
部分置換（`replace_file_content`）の失敗や不整合を回避するため、`write_to_file` を使用して **ファイル全体を強制的に上書き** します。

## 発動条件 (Trigger)

ユーザーから以下の旨の指摘があった場合：

- 「変更が反映されていない」
- 「ファイルが変わっていない」
- 「その変更を確認できない」
- 「Workflow-025 を実行して」

## 手順 (Step-by-Step)

1.  **最新状態の取得 (Fetch)**:

    - 必ず `view_file` ツールを実行し、対象ファイルの **最新の全内容** をファイルシステムから読み込みます。
    - **禁止**: AI のメモリ内の記憶だけで編集内容を構築してはいけません（他ツールによる変更やフォーマッターの影響を見落とすため）。

2.  **完全なコードの構築 (Reconstruct)**:

    - 取得した最新コードに対し、本来適用するはずだった変更を適用し、ファイル全体のテキストデータを作成します。

3.  **強制上書き実行 (Force Overwrite)**:

    - `write_to_file` ツールを使用します。
    - **TargetFile**: ユーザーが指摘した（編集対象の）ファイルの絶対パス。
    - **Overwrite**: `true` (必須)。
    - **CodeContent**: 手順 2 で作成した完全なテキスト。

4.  **報告 (Report)**:
    - ユーザーに対し、以下のフォーマットで報告します。
      > 「ファイル編集の不整合を解消するため、Workflow-025 に基づき全文上書きを実行しました。
      > 対象ファイル: [ファイルの絶対パス]」

## チェックリスト

- [ ] `view_file` で最新のファイル内容を取得したか？
- [ ] `write_to_file` (Overwrite: true) を使用したか？
- [ ] 編集したファイルの絶対パスを報告したか？
