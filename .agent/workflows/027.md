---
description: ディスクリミネーテッド・ユニオンの分岐処理 (Objective Switch)
---

# [Workflow-027] ディスクリミネーテッド・ユニオンの分岐処理 (Objective Switch)

## 概要

TypeScript の Discriminated Union (タグ付き共用体) を分岐処理する際、標準の `switch` 文や `if` チェーンの代わりに、プロジェクト固有のユーティリティ `objectiveDiscriminantSwitch` を使用することを推奨するパターンです。

## 背景・目的

- **網羅性チェック (Exhaustiveness Check)**: `switch` 文では `default` 句の扱いなどで全てのケースを網羅しているかのチェックが漏れがちですが、オブジェクトのキーとして定義することで、TypeScript の型システムにより「ケース漏れ」をコンパイルエラーとして検知できます。
- **可読性**: ロジック（ハンドラ関数）と分岐制御（マッピング）が分離され、宣言的な記述になります。

## ルール (Rules)

### 1. 使用箇所

- `type: "A" | "B" | "C"` のような Discriminator を持つユニオン型を分岐する場合。
- 特に `Action` 型や `TriggerType` など、将来的に種類が増える可能性がある箇所。

### 2. 実装方法

`src/shared/utils/objectiveSwitch.ts` をインポートして使用します。

```typescript
import { objectiveDiscriminantSwitch } from "@shared/utils/objectiveSwitch";

// 1. 完全マッチ（全てのケースを網羅する必要がある）
const result = objectiveDiscriminantSwitch(
  {
    tap: (action) => handleTap(action),
    hold: (action) => handleHold(action),
    doubleTap: (action) => handleDouble(action),
  },
  action, // 対象オブジェクト
  "trigger" // Discriminator のキー名
);

// 2. 部分マッチ（一部だけ処理したい場合）
objectiveDiscriminantPartialSwitch(
  {
    mouseMove: (a) => updateMousePos(a),
    // remap や layerToggle は無視される
  },
  action,
  "type"
);
```

### 3. switch 文との使い分け

- 単純な `string` や `number` の分岐、または `break` / `return` フローが複雑に入り組むロジック（fallthrough 等）が必要な場合は、無理に `objectiveSwitch` を使わず、通常の `switch` 文を使用しても構いません。
- ただし、**型による網羅性保証**が重要なビジネスロジックでは `objectiveSwitch` を優先してください。

## チェックリスト

- [ ] ユニオン型の分岐に `objectiveDiscriminantSwitch` を使用しているか？
- [ ] ハンドラ関数は純粋関数、または副作用が明確に分離されているか？
- [ ] `biome-ignore` 等で型エラーを握りつぶしていないか？
