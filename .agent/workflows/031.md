---
description: 厳格なコードレビューと修正計画策定の手順
---

# [Workflow-031] 厳格なコードレビューと修正計画策定

## 概要

変更内容が大規模、複雑、あるいは重要なルールに関わる場合、漫然としたレビューを避け、**「文書化」「監査」「計画」** の 3 段階を経て確実に品質を保証するための手順です。AI はこのフローに従い、客観的なエビデンスに基づいたレビューを行います。

## 適用タイミング

- 変更ファイル数が 5 以上、または機能追加を含む変更のレビュー時。
- ユーザーから「レビューが甘い」「詳しく見て」等の指摘を受けた時。
- Untracked files を含む新規実装のコミット前レビュー。

## 手順 (Step-by-Step)

### 1. 変更の文書化 (Documentation)

レビュー対象の全容を把握するため、まずは現状をありのままに記述したレポートを作成します。

- **アクション**: `review_report.md` を作成（または更新）。
- **記載内容**:
  - **変更ファイル一覧**: ステータス（Modified/New/Deleted）と共にリスト化。
  - **変更内容の要約**: ファイルごとに「何が変わったか」を 1 行で記述。
  - **意図の推定**: なぜその変更が行われたか？（文脈からの推測）。

### 2. ルール遵守チェック (Audit)

文書化された変更に対し、プロジェクトのルールを「法律」として適用し、適合性を判定します。

- **アクション**: `review_report.md` に「監査結果」セクションを追加。
- **チェック項目 (Audit Checklist)**:
  - [ ] **Atomic Design**: 新規コンポーネントの配置（atoms, molecules, etc.）は適切か？
  - [ ] **Directory Structure**: 独自のディレクトリ（例: `manager/`）を勝手に作っていないか？
  - [ ] **Props Grouping**: バケツリレーが発生していないか？ `[Workflow-001/005]` 違反はないか？
  - [ ] **Data/Config Separation**: 設定やデータ保存は `[Workflow-026]` に従っているか？
  - [ ] **Naming Convention**: ファイル名、変数名は命名規則に従っているか？
  - [ ] **Type Safety**: `any` や不適切な型アサーションはないか？

### 3. 修正計画の策定 (Correction Plan)

監査で検出された違反（Violation）に対し、具体的な修正アクションを定義します。

- **アクション**: `review_report.md` に「修正計画」セクションを追加。
- **計画内容**:
  - **タスクリスト**: ファイル移動、リファクタリング、型修正などの具体的な作業。
  - **コミット戦略**: 修正をどのような粒度でコミットするか。承認された変更と修正すべき変更を分けるか。

### 4. ユーザー報告と承認

作成したレポートをユーザーに提示し、修正計画への承認を求めます。

- **メッセージ例**:
  > 「[Workflow-031] に基づき厳格なレビューを行いました。以下の違反が見つかったため、コミット前に修正が必要です。計画を実行してよろしいでしょうか？」

## 出力アーティファクト例

`review_report.md`:

```markdown
# コードレビューレポート

## 1. 変更内容一覧

- `src/renderer/components/NewComponent.tsx` (New): 新機能の UI
  ...

## 2. 監査結果

- ❌ **Atomic Design 違反**: `NewComponent` は `molecules` ではなく `organisms` であるべき。
- ❌ **Props Grouping 違反**: `useCustomHook` からの返り値を個別に渡しすぎている。

## 3. 修正計画

- [ ] `NewComponent.tsx` を `organisms/` へ移動。
- [ ] Props を `UserConfig` 型にまとめて渡すようにリファクタリング。
```
