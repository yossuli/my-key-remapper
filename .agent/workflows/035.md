---
description: 大規模置換におけるスクリプト言語の選択
---

# [Workflow-035] 大規模置換におけるスクリプト言語の選択 (Script Language Selection for Large-scale Replacement)

## 概要

パスエイリアスの追加やリファクタリングなど、プロジェクト全体に及ぶ大規模な置換作業を行う際、どのような手段（言語・ツール）を選択すべきかの指針を定めます。

## 課題 (Problem)

Windows 環境（PowerShell）において、ファイル内容を大規模に書き換えるコマンドやスクリプトを実行する際、以下の問題が発生するリスクがあります。

1.  **文字化け (Encoding Issues)**: PowerShell のデフォルトエンコーディング（Shift-JIS/CP932 など）と、プロジェクトファイル（UTF-8）の不整合により、日本語コメントや特定の文字が破壊される。
2.  **監査性の低下**: PowerShell のワンライナーや複雑なスクリプトは可読性が低く、AI が生成したコードをユーザーがレビューする際のコストが高い。

## 解決策 (Solution)

大規模な置換を行う際は、**Node.js (JavaScript/TypeScript) スクリプト** を作成して実行することを標準とします。

### ✅ Good Example (Node.js Script)

```javascript
/* replacer.js */
const fs = require("fs");
const path = require("path");

// 明示的な UTF-8 指定により文字化けを回避
const content = fs.readFileSync("target.ts", "utf8");
const newContent = content.replace(/Old/g, "New");
fs.writeFileSync("target.ts", newContent, "utf8");
```

### ❌ Bad Example (PowerShell One-liner)

```powershell
Get-ChildItem -Recurse *.ts | ForEach-Object { (Get-Content $_).Replace('Old', 'New') | Set-Content $_ }
# エンコーディング指定がなく、システムロケールに依存して破壊される可能性が高い
```

## 手順 (Step-by-Step)

1.  **判定**: 3 ファイル以上、または正規表現を含む複雑な置換が必要か？
    - Yes -> 本ワークフローを適用。
    - No -> `multi_replace_file_content` ツールで直接編集。
2.  **スクリプト作成**: プロジェクトルートに作業用の JS ファイル（例: `scripts/replace_alias.js`）を作成する。
    - `fs` モジュール等を使用し、必ず `utf8` エンコーディングを指定する。
    - `dry-run` モード（書き込まずにログ出力のみ）を実装し、事前確認できるようにする。
3.  **レビュー**: ユーザーにスクリプトの内容を提示し、承認を得る。
4.  **実行**: `node scripts/replace_alias.js` を実行する。
5.  **クリーンアップ**: 作業完了後、一時スクリプトを削除する。


## 知見の種 (Seed) の記録

運用を通じて得られた「コーディングパターンの改善案」や「ルールの例外事例」は、`seeds.md` (Working Dir) へ記録してください（[Workflow-seed] 準拠）。

## 知見の継続的改善 (Continuous Knowledge Improvement)

このワークフローを自律的に強化し続けるため、改善点があれば本ファイル (`.agent/workflows/035.md`) 自体の更新を提案してください。
