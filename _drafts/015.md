---
description: 設定項目の追加
---

# [Workflow-015] 設定項目の追加 (Add Config Field)

## 概要

アプリケーション設定 (`RemapConfig`) に新しいフィールドを追加する際の一貫した手順です。型定義、初期値、保存処理、バリデーションなどの変更漏れを防ぎます。

## 手順 (Step-by-Step)

### 1. 型定義の更新 (`remapConfig.ts`)

- `src/shared/types/remapConfig.ts` 内の `RemapConfig` インターフェース（または関連する下位型）に新しいフィールドを追加します。
- **JSDoc コメント**:
  - 日本語で記述してください。
  - ただし、型名から内容が明白で単純なものに関しては省略可能です。
  - ※「どの程度を小さい・単純とするか」の基準は、今後の修正指示を通じて本ドキュメントに知見として蓄積し、定量化していきます。

### 2. デフォルト値の更新 (`constants.ts`)

- `src/shared/constants/xxxx.ts` (通常は `DEFAULT_REMAP_CONFIG` がある場所) を更新し、新しいフィールドのデフォルト値を設定します。
- これを行わないと、新規ユーザーや設定リセット時に `undefined` になる可能性があります。

### 3. ストレージロジックの確認 (`configStorage.ts`)

- `src/main/storage/configStorage.ts` を確認します。
- 単純なフィールド追加であれば `JSON.parse` / `JSON.stringify` で自動的に扱われますが、特別な変換（Set/Map など）が必要な場合は `load()` / `save()` メソッドを修正します。
- **マイグレーション**: 既存のユーザー設定ファイル (`key-mapping-config-v2.json`) に新フィールドがない場合でも、アプリがクラッシュしないか確認します（Step 2 のデフォルト値とのマージロジック等）。

### 4. バリデーション/利用箇所の更新

- 必要であれば、設定値を読み込む箇所（`ConfigContext` や `hooks`）を更新します。

### 5. Config UI の追加 (Optional)

- ユーザーが設定を変更するための UI (Settings Page) に入力フォームを追加します。

## チェックリスト

- [ ] `RemapConfig` の型定義を更新したか？
- [ ] `DEFAULT_REMAP_CONFIG` に初期値を追加したか？
- [ ] 既存の設定ファイルを読み込んだ際にエラーにならないか（後方互換性）？

## 知見の継続的改善

設定システムの構造が変わった場合は、本ドキュメントを更新してください。
