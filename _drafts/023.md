---
description: レビュー用ドラフト作成
---

# [Workflow-023] レビュー用ドラフト作成 (Review-Friendly Document Creation)

## 概要

`.agent/workflows` などの特殊ディレクトリや、エディタの挙動により直接レビューが困難な場所にドキュメントを作成する場合、まず一時的なディレクトリ（`_drafts/` 等）に作成してレビューを受け、承認後に正式な場所に移動・リネームする手順です。

## 手順 (Step-by-Step)

### 1. ドラフトディレクトリの準備

- プロジェクトルートに `_drafts/` ディレクトリが存在するか確認し、なければ作成します。
  ```bash
  mkdir _drafts
  ```

### 2. ドラフトファイルの作成・編集

- **新規作成の場合**:
  - 作成したいファイルのファイル名（例: `Workflow-XXX.md`）で、`_drafts/` 配下にファイルを作成します。
  - `write_to_file` ツールを使用します。
- **既存ファイルを編集する場合 [差分可視化フロー]**:
  1. **オリジナルをコピー**: `cp` コマンド等を使用し、元のファイルをそのまま `_drafts/` 配下にコピーします。
  2. **ステージング**: `git add _drafts/ファイル名` を実行し、変更前の状態を Git に登録します。
  3. **編集**: コピーしたドラフトファイルに対して `replace_file_content` 等で修正を行います。
  4. **Diff の確認**: これにより、ユーザーはエディタ上で「元の内容」と「AI の提案」の差分を正確に確認できるようになります。

### 3. ユーザーレビュー依頼

- `notify_user` を使用して、作成・修正したドラフトファイルのレビューを依頼します。
- **PathsToReview** にドラフトファイルのパスを含めます。
- メッセージ例:
  - 「`[Workflow-XXX] タイトル` のドラフトを作成しました。」
  - 「既存の `Workflow-XXX` を修正しました。エディタの Diff 機能で差分をご確認ください。」

### 4. 正式配置への移動（承認後）

- ユーザーの承認（y/OK）を得たら、ファイルを正式なディレクトリに移動します。
- この際、`run_command` は **`SafeToAutoRun: false`** で実行し、ユーザーが実行コマンドを最終確認できるようにします。
  ```bash
  # Git管理下のファイル移動を推奨
  git mv _drafts/Workflow-XXX.md .agent/workflows/XXX.md
  ```
- 必要に応じて、ファイル内のリンクや参照を修正します。

### 5. ディレクトリの維持

- `_drafts/` ディレクトリは削除せず、次回の作業のために維持します。
- 不要になったドラフトファイルのみ、必要に応じて削除またはアーカイブします。

## チェックリスト

- [ ] 直接 `.agent/workflows` に作成せず、`_drafts/` を使用したか？
- [ ] ユーザーにドラフトのレビューを依頼したか？
- [ ] 承認後に正式な場所へ移動したか？

## 知見の継続的改善

レビュー手順や一時ディレクトリの運用に変更がある場合は、本ドキュメントを更新してください。
